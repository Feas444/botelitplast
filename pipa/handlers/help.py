# help.py

from telegram import Update
from telegram.ext import ContextTypes
from db import get_role
from config import DEVELOPER_USERNAME

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    Отправляет справку для пользователей.
    Команды через слэш: только /start и /help.
    Остальной функционал реализован через кнопки главного меню.
    
    Для обычных пользователей доступны:
      • "Общие файлы" – файлы, доступные всем;
      • "Файлы работы" – файлы, привязанные к вашей роли;
      • "Сообщения" – просмотр и отправка сообщений;
      • "Поиск файлов" – поиск нужных документов.
      
    Для администратора (и разработчика) дополнительно доступны:
      • "Админ‑панель" – создание/удаление тестов, файловый менеджер и прочее.
      
    Навигация осуществляется исключительно через кнопки.
    """
    user_id = update.effective_user.id
    role = get_role(user_id) or ""
    dev_name = (update.effective_user.username or "").lower()

    if role.lower() == "администратор" or dev_name == DEVELOPER_USERNAME.lower():
        text = (
            "Справка для администратора:\n\n"
            "• Команды через слэш: только /start и /help.\n"
            "• Основной функционал доступен через кнопки главного меню:\n"
            "   - «Общие файлы» – доступ к общей папке с файлами.\n"
            "   - «Файлы работы» – файлы, привязанные к вашей роли.\n"
            "   - «Сообщения» – просмотр, отправка сообщений, тесты и уведомления.\n"
            "   - «Поиск файлов» – поиск документов.\n"
            "   - «Админ‑панель» – функции администрирования (создание/удаление тестов, файловый менеджер и т.д.).\n\n"
            "Используйте кнопки для навигации."
        )
    await update.message.reply_text(text)
